#
# "$Id$"
#
#   Makefile for the CUPS drivers.
#
#   Copyright 1993-2000 by Easy Software Products.
#
#   This program is free software; you can redistribute it and/or
#   modify it under the terms of the GNU General Public License,
#   version 2, as published by the Free Software Foundation.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program; if not, please contact Easy Software
#   Products at:
#
#       Attn: CUPS Licensing Information
#       Easy Software Products
#       44141 Airport View Drive, Suite 204
#       Hollywood, Maryland 20636-3111 USA
#
#       Voice: (301) 373-9603
#       EMail: cups-info@cups.org
#         WWW: http://www.cups.org
#

#
# Definitions...
#

AR	=	ar
ARFLAGS	=	crvs
CC	=	@CC@
CFLAGS	=	@CFLAGS@ @DEFS@
CHMOD	=	@CHMOD@
CP	=	@CP@
LDFLAGS	=	@LDFLAGS@
LIBS	=	@LIBS@
MKDIR	=	@MKDIR@
RANLIB	=	:


#
# Directories...
#

bindir		=	@bindir@
datadir		=	@datadir@
exec_prefix	=	@exec_prefix@
libdir		=	@libdir@
prefix		=	@prefix@
sysconfdir	=	@sysconfdir@


#
# Rules...
#

.SILENT:
.SUFFIXES:	.c .o

.c.o:
	echo Compiling $<
	$(CC) $(CFLAGS) -c $<


#
# Files...
#

TARGETS	=	libdrv.a calibrate commandtoepson epson genppd \
		ppd rastertoprinter
DRVOBJS	=	cups-canon.o cups-dither.o cups-escp2.o cups-pcl.o \
		cups-ps.o cups-util.o cups-weave.o
OBJS	=	$(DRVOBJS) calibrate.o commandtoepson.o epson.o genppd.o \
		rastertoprinter.o


#
# Make all targets...
#

all:
	echo Using $(CC) for C compiler.
	echo Using \"$(CFLAGS)\" for compiler options.
	echo Using \"$(LDFLAGS)\" for linker options.
	echo Using \"$(LIBS)\" for libraries.
	$(MAKE) $(TARGETS)

#
# Clean all object files...
#

clean:
	$(RM) $(OBJS) $(TARGETS)
	$(RM) -r ppd/*


#
# Install all targets...
#

install:
	echo Installing calibration utility...
	-$(MKDIR) $(bindir)
	$(CP) calibrate $(bindir)
	$(CHMOD) a+rx $(bindir)/calibrate
	-$(MKDIR) $(datadir)/cups
	$(CP) calibrate.ppm $(datadir)/cups
	$(CHMOD) a+r $(datadir)/cups/calibrate.ppm

	echo Installing drivers...
	-$(MKDIR) $(libdir)/cups/backend
	$(CP) epson $(libdir)/cups/backend
	$(CHMOD) a+rx $(libdir)/cups/backend/epson

	-$(MKDIR) $(libdir)/cups/filter
	$(CP) rastertoprinter $(libdir)/cups/filter
	$(CHMOD) a+rx $(libdir)/cups/filter/rastertoprinter
	$(CP) commandtoepson $(libdir)/cups/filter
	$(CHMOD) a+rx $(libdir)/cups/filter/commandtoepson

	echo Installing PPD files...
	-$(MKDIR) $(datadir)/cups/model
	$(CP) ppd/* $(datadir)/cups/model
	$(CHMOD) a+r $(datadir)/cups/model/*

	echo Installing new command MIME type...
	-$(MKDIR) $(sysconfdir)/cups
	$(CP) command.types $(sysconfdir)/cups
	$(CHMOD) a+r $(sysconfdir)/cups/command.types


#
# calibrate
#

calibrate:	calibrate.o
	echo Linking $@...
	$(CC) $(LDFLAGS) -o calibrate calibrate.o -lm


#
# commandtoepson
#

commandtoepson:	commandtoepson.o
	echo Linking $@...
	$(CC) $(LDFLAGS) -o commandtoepson commandtoepson.o $(LIBS)


#
# epson
#

epson:	epson.o
	echo Linking $@...
	$(CC) $(LDFLAGS) -o epson epson.o $(LIBS)


#
# genppd
#

genppd:	genppd.o libdrv.a
	echo Linking $@...
	$(CC) $(LDFLAGS) -o genppd genppd.o libdrv.a $(LIBS)

genppd.o:	cups-print.h cups-printers.c


#
# ppd
#

ppd:	genppd
	echo Cleaning old PPD files...
	$(RM) -r ppd/*
	echo Running $@...
	./genppd


#
# libdrv.a
#

libdrv.a:	$(DRVOBJS)
	echo Archiving $@...
	$(RM) $@
	$(AR) $(ARFLAGS) $@ $(DRVOBJS)
	$(RANLIB) $@

$(DRVOBJS):	cups-print.h cups-quickmatrix257.h cups-ran.367.179.h
cups-util.c:	cups-printers.c


#
# rastertoprinter
#

rastertoprinter:	rastertoprinter.o libdrv.a
	echo Linking $@...
	$(CC) $(LDFLAGS) -o rastertoprinter rastertoprinter.o libdrv.a $(LIBS)

rastertoprinter.o:	cups-print.h cups-quickmatrix257.h cups-ran.367.179.h


#
# End of "$Id$".
#
