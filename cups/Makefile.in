#
# "$Id$"
#
#   Makefile for the CUPS driver development kit.
#
#   Copyright 1997-2000 by Easy Software Products, all rights reserved.
#
#   These coded instructions, statements, and computer programs are the
#   property of Easy Software Products and are protected by Federal
#   copyright law.  Distribution and use rights are outlined in the file
#   "LICENSE.txt" which should have been included with this file.  If this
#   file is missing or damaged please contact Easy Software Products
#   at:
#
#       Attn: CUPS Licensing Information
#       Easy Software Products
#       44141 Airport View Drive, Suite 204
#       Hollywood, Maryland 20636-3111 USA
#
#       Voice: (301) 373-9603
#       EMail: cups-info@cups.org
#         WWW: http://www.cups.org
#

#
# Definitions...
#

AR	=	ar
ARFLAGS	=	crvs
CC	=	@CC@
CFLAGS	=	@CFLAGS@ @DEFS@
CHMOD	=	@CHMOD@
CP	=	@CP@
LDFLAGS	=	@LDFLAGS@
LIBS	=	@LIBS@
MKDIR	=	@MKDIR@
PREFIX	=	@prefix@
RANLIB	=	:


#
# Rules...
#

.SILENT:
.SUFFIXES:	.c .o

.c.o:
	echo Compiling $<
	$(CC) $(CFLAGS) -c $<


#
# Files...
#

TARGETS	=	libdrv.a calibrate commandtoepson epson genppd \
		rastertoprinter
DRVOBJS	=	cups-canon.o cups-dither.o cups-escp2.o cups-pcl.o \
		cups-ps.o cups-util.o cups-weave.o
OBJS	=	$(DRVOBJS) calibrate.o commandtoepson.o epson.o genppd.o \
		rastertoprinter.o


#
# Make all targets...
#

all:	$(TARGETS)


#
# Clean all object files...
#

clean:
	$(RM) $(OBJS) $(TARGETS)
	$(RM) ppd/*


#
# Install all targets...
#

install:
	echo Installing calibration utility...
	-$(MKDIR) $(PREFIX)/bin
	$(CP) calibrate $(PREFIX)/bin
	$(CHMOD) 755 $(PREFIX)/bin/calibrate

	echo Installing EPSON drivers...
	-$(MKDIR) $(PREFIX)/lib/cups/backend
	$(CP) epson $(PREFIX)/lib/cups/backend
	$(CHMOD) 755 $(PREFIX)/lib/cups/backend/epson

	-$(MKDIR) $(PREFIX)/lib/cups/filter
	$(CP) rastertoprinter $(PREFIX)/lib/cups/filter
	$(CHMOD) 755 $(PREFIX)/lib/cups/filter/rastertoprinter
	$(CP) commandtoepson $(PREFIX)/lib/cups/filter
	$(CHMOD) 755 $(PREFIX)/lib/cups/filter/commandtoepson

	-$(MKDIR) $(PREFIX)/share/cups/model
	$(CP) ppd/* $(PREFIX)/share/cups/model
	$(CHMOD) a+r $(PREFIX)/share/cups/model/*


#
# calibrate
#

calibrate:	calibrate.o
	echo Linking $@...
	$(CC) $(LDFLAGS) -o calibrate calibrate.o -lm


#
# commandtoepson
#

commandtoepson:	commandtoepson.o
	echo Linking $@...
	$(CC) $(LDFLAGS) -o commandtoepson commandtoepson.o $(LIBS)


#
# epson
#

epson:	epson.o
	echo Linking $@...
	$(CC) $(LDFLAGS) -o epson epson.o $(LIBS)


#
# genppd
#

genppd:	genppd.o libdrv.a
	echo Linking $@...
	$(CC) $(LDFLAGS) -o genppd genppd.o libdrv.a $(LIBS)
	echo Cleaning old PPD files...
	$(RM) ppd/*
	echo Running $@...
	genppd

genppd.o:	cups-print.h cups-printers.c


#
# libdrv.a
#

libdrv.a:	$(DRVOBJS)
	echo Archiving $@...
	$(RM) $@
	$(AR) $(ARFLAGS) $@ $(DRVOBJS)
	$(RANLIB) $@

$(DRVOBJS):	cups-print.h cups-quickmatrix257.h cups-ran.367.179.h
cups-util.c:	cups-printers.c


#
# rastertoprinter
#

rastertoprinter:	rastertoprinter.o libdrv.a
	echo Linking $@...
	$(CC) $(LDFLAGS) -o rastertoprinter rastertoprinter.o libdrv.a $(LIBS)

rastertoprinter.o:	cups-print.h cups-quickmatrix257.h cups-ran.367.179.h


#
# End of "$Id$".
#
