#
# "$Id$"
#
#   Makefile for the CUPS drivers.
#
#   Copyright 1993-2000 by Easy Software Products.
#
#   This program is free software; you can redistribute it and/or
#   modify it under the terms of the GNU General Public License,
#   version 2, as published by the Free Software Foundation.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program; if not, please contact Easy Software
#   Products at:
#
#       Attn: CUPS Licensing Information
#       Easy Software Products
#       44141 Airport View Drive, Suite 204
#       Hollywood, Maryland 20636-3111 USA
#
#       Voice: (301) 373-9603
#       EMail: cups-info@cups.org
#         WWW: http://www.cups.org
#

#
# Definitions...
#

AR	=	ar
ARFLAGS	=	crvs
CC	=	@CC@
CFLAGS	=	@CFLAGS@ @DEFS@
CHMOD	=	@CHMOD@
CP	=	@CP@
ECHO	=	@ECHO@
LDFLAGS	=	@LDFLAGS@
LIBS	=	@LIBS@
MKDIR	=	@MKDIR@
RANLIB	=	:
SHELL	=	/bin/sh
SILENT	=	@SILENT@


#
# Directories...
#

bindir		=	@bindir@
datadir		=	@datadir@
exec_prefix	=	@exec_prefix@
libdir		=	@libdir@
prefix		=	@prefix@
sysconfdir	=	@sysconfdir@


#
# Rules...
#

.SUFFIXES:	.c .o

.c.o:
	$(ECHO) Compiling $<
	$(SILENT) $(CC) $(CFLAGS) -c $<


#
# Files...
#

TARGETS	=	libdrv.a calibrate commandtoepson epson genppd \
		ppd rastertoprinter commandtocanon canon
DRVOBJS	=	cups-canon.o cups-dither.o cups-escp2.o cups-pcl.o \
		cups-ps.o cups-lexmark.o cups-util.o cups-weave.o
OBJS	=	$(DRVOBJS) calibrate.o commandtoepson.o epson.o genppd.o \
		rastertoprinter.o commandtocanon.o canon.o


#
# Make all targets...
#

all:
	$(ECHO) Using $(CC) for C compiler.
	$(ECHO) Using \"$(CFLAGS)\" for compiler options.
	$(ECHO) Using \"$(LDFLAGS)\" for linker options.
	$(ECHO) Using \"$(LIBS)\" for libraries.
	$(SILENT) $(MAKE) $(TARGETS)

#
# Clean all object files...
#

clean:
	$(ECHO) Cleaning object and generated files...
	$(SILENT) $(RM) -r ppd
	$(SILENT) $(RM) $(OBJS) $(TARGETS)


#
# Install all targets...
#

install:	all
	$(ECHO) Installing calibration utility...
	$(SILENT) if test ! -d $(bindir); then \
		$(MKDIR) $(bindir); \
	fi
	$(SILENT) $(CP) calibrate $(bindir)
	$(SILENT) $(CHMOD) a+rx $(bindir)/calibrate
	$(SILENT) if test ! -d $(datadir)/cups; then \
		$(MKDIR) $(datadir)/cups; \
	fi
	$(SILENT) $(CP) calibrate.ppm $(datadir)/cups
	$(SILENT) $(CHMOD) a+r $(datadir)/cups/calibrate.ppm

	$(ECHO) Installing drivers...
	$(SILENT) if test ! -d $(libdir)/cups/backend; then \
		$(MKDIR) $(libdir)/cups/backend; \
	fi
	$(SILENT) $(CP) epson $(libdir)/cups/backend
	$(SILENT) $(CHMOD) a+rx $(libdir)/cups/backend/epson
	$(SILENT) $(CP) canon $(libdir)/cups/backend
	$(SILENT) $(CHMOD) a+rx $(libdir)/cups/backend/canon

	$(SILENT) if test ! -d $(libdir)/cups/filter; then \
		$(MKDIR) $(libdir)/cups/filter; \
	fi
	$(SILENT) $(CP) rastertoprinter $(libdir)/cups/filter
	$(SILENT) $(CHMOD) a+rx $(libdir)/cups/filter/rastertoprinter
	$(SILENT) $(CP) commandtoepson $(libdir)/cups/filter
	$(SILENT) $(CHMOD) a+rx $(libdir)/cups/filter/commandtoepson
	$(SILENT) $(CP) commandtocanon $(libdir)/cups/filter
	$(SILENT) $(CHMOD) a+rx $(libdir)/cups/filter/commandtocanon

	$(ECHO) Installing PPD files...
	$(SILENT) if test ! -d $(datadir)/cups/model; then \
		$(MKDIR) $(datadir)/cups/model; \
	fi
	$(SILENT) $(CP) ppd/* $(datadir)/cups/model
	$(SILENT) $(CHMOD) a+r $(datadir)/cups/model/*

	$(ECHO) Installing new command MIME type...
	$(SILENT) if test ! -d $(sysconfdir)/cups; then \
		$(MKDIR) $(sysconfdir)/cups; \
	fi
	$(SILENT) $(CP) command.types $(sysconfdir)/cups
	$(SILENT) $(CHMOD) a+r $(sysconfdir)/cups/command.types


#
# calibrate
#

calibrate:	calibrate.o
	$(ECHO) Linking $@...
	$(SILENT) $(CC) $(LDFLAGS) -o calibrate calibrate.o -lm


#
# commandtoepson
#

commandtoepson:	commandtoepson.o
	$(ECHO) Linking $@...
	$(SILENT) $(CC) $(LDFLAGS) -o commandtoepson commandtoepson.o $(LIBS)


#
# epson
#

epson:	epson.o
	$(ECHO) Linking $@...
	$(SILENT) $(CC) $(LDFLAGS) -o epson epson.o $(LIBS)

#
# commandtocanon
#

commandtocanon: commandtocanon.o
	$(ECHO) Linking $@...
	$(SILENT) $(CC) $(LDFLAGS) -o commandtocanon commandtocanon.o $(LIBS)


#
# canon
#

canon:	canon.o
	$(ECHO) Linking $@...
	$(SILENT) $(CC) $(LDFLAGS) -o canon canon.o $(LIBS)


#
# genppd
#

genppd:	genppd.o libdrv.a
	$(ECHO) Linking $@...
	$(SILENT) $(CC) $(LDFLAGS) -o genppd genppd.o libdrv.a $(LIBS)

genppd.o:	cups-print.h cups-printers.c


#
# ppd
#

ppd:	genppd
	$(ECHO) Cleaning old PPD files...
	$(SILENT) $(RM) -r ppd/*
	$(ECHO) Running $@...
	$(SILENT) ./genppd


#
# libdrv.a
#

libdrv.a:	$(DRVOBJS)
	$(ECHO) Archiving $@...
	$(SILENT) $(RM) $@
	$(SILENT) $(AR) $(ARFLAGS) $@ $(DRVOBJS)
	$(SILENT) $(RANLIB) $@

$(DRVOBJS):	cups-print.h cups-quickmatrix257.h cups-ran.367.179.h
cups-util.c:	cups-printers.c


#
# rastertoprinter
#

rastertoprinter:	rastertoprinter.o libdrv.a
	$(ECHO) Linking $@...
	$(SILENT) $(CC) $(LDFLAGS) -o rastertoprinter rastertoprinter.o libdrv.a $(LIBS)

rastertoprinter.o:	cups-print.h cups-quickmatrix257.h cups-ran.367.179.h


#
# End of "$Id$".
#
